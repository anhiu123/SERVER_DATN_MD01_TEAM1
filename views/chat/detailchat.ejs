<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="/bootstrap-5.3.0-dist/css/bootstrap.min.css">     
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>  .no-underline, .no-underline:hover, .no-underline:focus, .no-underline:active {
        text-decoration: none !important;
      }
      .message.other .media .media-body p {
        word-wrap: break-word; /* Tự động xuống dòng khi tin nhắn quá dài */
    }
    
    .message.other .media .media-body {
        display: flex;
        flex-direction: column;
    }
    
    .message.other .media .media-body .d-flex {
        justify-content: flex-start;
    }
    
    .message.other .media .media-body img {
        order: -1; /* Di chuyển ảnh lên trên cùng */
    }
    
      .chat-container {
        max-width: 600px;
        margin: 50px auto;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .chat-messages {
        padding: 15px;
        overflow-y: scroll;
        height: 400px;
    }
    .message {
        margin-bottom: 15px;
    }
    .message p {
        padding: 10px 15px;
        border-radius: 20px;
        max-width: 70%;
    }
    .message.me p {
        background-color: #007bff;
        color: #fff;
        float: right;
    }
    .message.other p {
        background-color: #f0f0f0;
        color: #333;
        float: left;
    }
    .message-time {
        font-size: 12px;
        color: #888;
        margin-top: 0px;
    }
    
    </style>
</head>
<body>
    
 <!-- khối 1  -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 d-flex align-items-center" style="height: 100px;">
                <div style="font-size: 24px;">
                    <i class="fas fa-phone" style="font-size: 34px;"></i>
                    +84 0967977673
                </div>
                <div style="font-size: 24px;" class="ms-5">
                    <i class="far fa-envelope"  style="font-size: 34px;"></i>
                    <%= objU.email %>
                </div>
                <div style="font-size: 24px; margin-left:730px ;">
                    <i class="fas fa-bell"  style="font-size: 34px;"></i>
                    Thông Báo
                </div>
                <div style="font-size: 24px; margin-left:130px ;">
                    <i class="fas fa-user"  style="font-size: 34px;"></i>
                    <%= objU.role %>
                </div>
             
            </div>
            <hr>

            <!-- Khối 2 -->
            <div class=" col-12">
                <div class="align-items-center bg-white">
                    <nav class="navbar navbar-expand-lg bg-body-tertiary">
                        <div class="container-fluid">
                          <a class="navbar-brand" href="/sanpham/home">Home </a>
                          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                          </button>
                          <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    
                        
                            
                      </nav>
                </div>
            </div>
            
            <div class="ms-4 ms-4"><h1> Chat  </h1>
              <a href="/chat">Chat /</a>
              <% if(msg.length>0) {%>
                <h3> <%= msg %> đụ má </h3>
                <% } %>
            
            </div>
           
            <div class=" col-12 col-sm-3 col-md-2"></div>
         
            <div class=" col-12 col-sm-9 col-md-8">
              <div class="mt-5">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                     
                    </div>
                </div>
                
                <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
                <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>

                <script>
                    // Initialize Firebase
                    const firebaseConfig = {
                        apiKey: "AIzaSyDLfpPbdOKneNtDMzH1VszPLGJSr-lmQOQ",
                authDomain: "vidu2-96b2f.firebaseapp.com",
                databaseURL: "https://vidu2-96b2f-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "vidu2-96b2f",
                storageBucket: "vidu2-96b2f.appspot.com",
                messagingSenderId: "474743315722",
                appId: "1:474743315722:web:7435376f395eef8a27eef3",
                measurementId: "G-8LF86WD24S"
                    };
                    firebase.initializeApp(firebaseConfig);
            
                    const db = firebase.database();
            
                    // Reference to your messages node in Firebase
                    const messagesRef = db.ref('tinnhan');
            
                    // Function to fetch messages from Firebase and display them
                    function fetchAndDisplayMessages() {
                        messagesRef.on('value', (snapshot) => {
                            const chatMessages = document.getElementById('chatMessages');
                            chatMessages.innerHTML = ''; // Clear existing messages
                            snapshot.forEach((childSnapshot) => {
                                const message = childSnapshot.val();
                                const messageDiv = document.createElement('div');
                                messageDiv.classList.add('message', message.sender === 'admin' ? 'me' : 'other');
                                // Customize messageDiv inner HTML based on your message structure
                                if (message.sender === 'admin' ) {
                                    messageDiv.innerHTML = `
                                    <div  class="message-content">  
                                        <div class="media">         
                                                                                                             
                                                    <div  class="media-body">                                                                                                      
                                                        <div style="margin-left:400px; margin-top:50px " class="message-time">${message.date}</div>
                                                        <p > ${message.content}</p> 
                                                        
                                                  
                                    </div>
                                </div>
                                </div>     
                                    `;
                                } else {
                                    messageDiv.innerHTML = `
                                        <div class="message-content">
                                            <div class="media">
                                                
                                                <div class="d-flex align-items-center" style="margin-top:50px">
                                                <% us.forEach((item)=>{ %>                                             
                                                        <img src="<%= item.image %>" class="mr-3 rounded-circle" alt="Avatar" style="width: 40px;">
                                                                                         
                                                <% })  %>                                  
                                               
                                                    <% us.forEach((item)=>{ %>  
                                                         <h5 style="margin-left:10px" class="mt-0"><%= item.username %></h5>                 
                                                <% })  %>  
                                                
                                            </div>                                 
                                                                                                                                                                                                                                                     
                                                    <div class="message-time">${message.date}</div>
                                                    <p>${message.content}</p>  
                                           
                                              <br>
                                            </div>
                                        </div>
                                    `;
                                }     
                                chatMessages.appendChild(messageDiv);
                            });
                        });
                    }
            
                    // Call the function to fetch and display messages
                    fetchAndDisplayMessages();
                </script>

                                </div>
                               
                                <div style="margin-left: 330px;" class="input-group">
                                    <form action="" method="post">
                                    <input style="width: 600px;" name="noidung" type="text" class="form-control" placeholder="Type your message">
                                   
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </form>
                                    </div>
                                </div>
                                
                              
                            </div>
                          
                        </div>
                    </div>
                  </div>
            </div></div>
           
            <div class=" col-12           col-md-2 d-none d-md-block"></div>
            <div class=" col-12 ">
              <img style="margin-left: 800px;margin-top: 50;" src="https://tse3.mm.bing.net/th?id=OIP.vR3c8gJDtTZuFFJLa3nHcwAAAA&pid=Api&P=0&h=180" alt="Mô tả ảnh" width="200" height="150">
            </div>
        </div>
</div> 




    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script> 
    <script src="/bootstrap-5.3.0-dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>